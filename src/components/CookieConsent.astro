---
// Cookie Consent Configuration for ComoLocal
// Uses vanilla-cookieconsent v3
// Docs: https://cookieconsent.orestbida.com/

import 'vanilla-cookieconsent/dist/cookieconsent.css';
import * as CookieConsent from 'vanilla-cookieconsent';
---

<script>
  import * as CookieConsent from 'vanilla-cookieconsent';

  // Initialize Cookie Consent
  CookieConsent.run({
    guiOptions: {
      consentModal: {
        layout: 'box wide',
        position: 'bottom left',
        equalWeightButtons: true,
        flipButtons: false
      },
      preferencesModal: {
        layout: 'box',
        position: 'right',
        equalWeightButtons: true,
        flipButtons: false
      }
    },

    categories: {
      necessary: {
        enabled: true,
        readOnly: true
      },
      analytics: {
        enabled: false,
        autoClear: {
          cookies: [
            { name: /^_ga/ },
            { name: '_gid' }
          ]
        }
      }
    },

    language: {
      default: 'en',
      autoDetect: 'browser',
      translations: {
        en: {
          consentModal: {
            title: '游꼵 Cookie Settings',
            description: 'We use cookies to understand how you use our site and improve your experience. You can choose which cookies to allow.',
            acceptAllBtn: 'Accept All',
            acceptNecessaryBtn: 'Reject All',
            showPreferencesBtn: 'Manage Preferences',
            footer: '<a href="/privacy/">Privacy Policy</a>'
          },
          preferencesModal: {
            title: 'Cookie Preferences',
            acceptAllBtn: 'Accept All',
            acceptNecessaryBtn: 'Reject All',
            savePreferencesBtn: 'Save Preferences',
            closeIconLabel: 'Close',
            serviceCounterLabel: 'Service|Services',
            sections: [
              {
                title: 'Cookie Usage',
                description: 'We use cookies to ensure the basic functionality of our website and to enhance your experience. You can choose to opt-in or opt-out of each category at any time.'
              },
              {
                title: 'Essential Cookies <span class="pm__badge">Always Active</span>',
                description: 'These cookies are necessary for the website to function and cannot be switched off. They are usually set in response to actions you take (e.g., setting your privacy preferences).',
                linkedCategory: 'necessary'
              },
              {
                title: 'Analytics Cookies',
                description: 'These cookies help us understand how visitors interact with our website by collecting information anonymously. This helps us improve our content and your experience.',
                linkedCategory: 'analytics',
                cookieTable: {
                  headers: {
                    name: 'Name',
                    domain: 'Domain',
                    description: 'Description',
                    expiration: 'Expiration'
                  },
                  body: [
                    {
                      name: '_ga',
                      domain: 'comolocal.es',
                      description: 'Google Analytics - Used to distinguish users',
                      expiration: '2 years'
                    },
                    {
                      name: '_gid',
                      domain: 'comolocal.es',
                      description: 'Google Analytics - Used to distinguish users',
                      expiration: '24 hours'
                    }
                  ]
                }
              },
              {
                title: 'More Information',
                description: 'For any questions about our cookie policy, please <a class="cc__link" href="/contact/">contact us</a>.'
              }
            ]
          }
        },
        es: {
          consentModal: {
            title: '游꼵 Configuraci칩n de Cookies',
            description: 'Usamos cookies para entender c칩mo usas nuestro sitio y mejorar tu experiencia. Puedes elegir qu칠 cookies permitir.',
            acceptAllBtn: 'Aceptar Todo',
            acceptNecessaryBtn: 'Rechazar Todo',
            showPreferencesBtn: 'Gestionar Preferencias',
            footer: '<a href="/privacy/">Pol칤tica de Privacidad</a>'
          },
          preferencesModal: {
            title: 'Preferencias de Cookies',
            acceptAllBtn: 'Aceptar Todo',
            acceptNecessaryBtn: 'Rechazar Todo',
            savePreferencesBtn: 'Guardar Preferencias',
            closeIconLabel: 'Cerrar',
            serviceCounterLabel: 'Servicio|Servicios',
            sections: [
              {
                title: 'Uso de Cookies',
                description: 'Usamos cookies para asegurar la funcionalidad b치sica de nuestro sitio web y mejorar tu experiencia. Puedes optar por aceptar o rechazar cada categor칤a en cualquier momento.'
              },
              {
                title: 'Cookies Esenciales <span class="pm__badge">Siempre Activas</span>',
                description: 'Estas cookies son necesarias para que el sitio web funcione y no se pueden desactivar.',
                linkedCategory: 'necessary'
              },
              {
                title: 'Cookies de Anal칤tica',
                description: 'Estas cookies nos ayudan a entender c칩mo los visitantes interact칰an con nuestro sitio web.',
                linkedCategory: 'analytics'
              },
              {
                title: 'M치s Informaci칩n',
                description: 'Para cualquier pregunta sobre nuestra pol칤tica de cookies, <a class="cc__link" href="/contact/">cont치ctanos</a>.'
              }
            ]
          }
        }
      }
    }
  });
</script>

<style is:global>
  /* Custom styling for vanilla-cookieconsent to match ComoLocal theme */
  
  :root {
    /* ComoLocal color variables mapped to cookie consent */
    --cc-bg: hsl(240 10% 10%);
    --cc-primary-color: hsl(0 0% 98%);
    --cc-secondary-color: hsl(240 5% 64.9%);
    --cc-btn-primary-bg: hsl(262.1 83.3% 57.8%);
    --cc-btn-primary-color: hsl(0 0% 98%);
    --cc-btn-primary-hover-bg: hsl(262.1 83.3% 47.8%);
    --cc-btn-secondary-bg: hsl(240 3.7% 20%);
    --cc-btn-secondary-color: hsl(0 0% 98%);
    --cc-btn-secondary-hover-bg: hsl(240 3.7% 30%);
    --cc-separator-border-color: hsl(240 3.7% 15.9%);
    --cc-cookie-category-block-bg: hsl(240 3.7% 15.9%);
    --cc-cookie-category-block-border: hsl(240 3.7% 20%);
    --cc-overlay-bg: rgba(0, 0, 0, 0.65);
    --cc-toggle-readonly-bg: hsl(262.1 83.3% 57.8%);
    --cc-toggle-on-bg: hsl(262.1 83.3% 57.8%);
    --cc-toggle-off-bg: hsl(240 3.7% 30%);
    --cc-font-family: 'Inter Variable', system-ui, sans-serif;
  }

  /* Modal styling */
  .cm,
  .pm {
    font-family: var(--cc-font-family) !important;
  }

  .cm {
    border-radius: 1rem !important;
    border: 1px solid hsl(240 3.7% 15.9%) !important;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5) !important;
  }

  .cm__title {
    font-weight: 700 !important;
    font-size: 1.25rem !important;
  }

  .cm__desc {
    color: var(--cc-secondary-color) !important;
    line-height: 1.6 !important;
  }

  /* Buttons */
  .cm__btn,
  .pm__btn {
    border-radius: 9999px !important;
    font-weight: 600 !important;
    padding: 0.75rem 1.5rem !important;
    transition: all 0.2s ease !important;
  }

  .cm__btn:hover,
  .pm__btn:hover {
    transform: translateY(-1px);
  }

  .cm__btn--secondary {
    border: 1px solid hsl(240 3.7% 25%) !important;
  }

  /* Preferences modal */
  .pm {
    border-radius: 1rem !important;
    border: 1px solid hsl(240 3.7% 15.9%) !important;
  }

  .pm__title {
    font-weight: 700 !important;
  }

  .pm__section-title {
    font-weight: 600 !important;
  }

  .pm__badge {
    background: hsl(262.1 83.3% 57.8% / 0.2) !important;
    color: hsl(262.1 83.3% 67.8%) !important;
    border-radius: 9999px !important;
    padding: 0.25rem 0.75rem !important;
    font-size: 0.75rem !important;
    font-weight: 600 !important;
  }

  /* Toggle switch */
  .pm__section--toggle .pm__section-title-wrapper {
    border-radius: 0.75rem !important;
  }

  /* Cookie table */
  .pm__table {
    border-radius: 0.5rem !important;
    overflow: hidden;
  }

  /* Footer link */
  .cm__footer a,
  .cc__link {
    color: hsl(262.1 83.3% 67.8%) !important;
    text-decoration: none !important;
  }

  .cm__footer a:hover,
  .cc__link:hover {
    text-decoration: underline !important;
  }

  /* Close button */
  .pm__close-btn {
    border-radius: 0.5rem !important;
  }

  .pm__close-btn:hover {
    background: hsl(240 3.7% 20%) !important;
  }
</style>
